<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å‹ç¼©è¡¨æ ¼ä¿®å¤è¯Šæ–­</title>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="js/processing/markdown_processor_ast.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', monospace;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #27ae60; }
        .fail { color: #e74c3c; }
        .result table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .result th, .result td {
            border: 1px solid #ddd;
            padding: 6px;
            font-size: 12px;
        }
        .result th {
            background: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å‹ç¼©è¡¨æ ¼ä¿®å¤è¯Šæ–­</h1>

    <div id="output"></div>

    <script>
        // æ‹¦æˆªæ‰€æœ‰ console.log
        const logs = [];
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        console.log = function(...args) {
            logs.push('[LOG] ' + args.join(' '));
            originalLog.apply(console, args);
        };

        console.warn = function(...args) {
            logs.push('[WARN] ' + args.join(' '));
            originalWarn.apply(console, args);
        };

        console.error = function(...args) {
            logs.push('[ERROR] ' + args.join(' '));
            originalError.apply(console, args);
        };

        const output = document.getElementById('output');
        const compressedTable = `| | | | äº”åˆ†ä½æ•° (Quintiles) | | | |---|---|---|---|---|---|---| | | 1 | 2 | 3 | 4 | 5 | 5-1 | | å¸‚åœº (Market) | 0.145*** | 0.200** | 0.061* | 0.136* | 0.106*** | -0.039 | | | (2.774) | (2.441) | (1.938) | (1.689) | (2.703) | (-0.930) | | è§„æ¨¡ (Size) | 0.107** | 0.329* | 0.147** | 0.206** | 0.059*** | 0.047 | | | (2.163) | (1.800) | (2.223) | (2.452) | (3.150) | (1.090) |`;

        // æ­¥éª¤1: éªŒè¯è¾“å…¥
        const section1 = document.createElement('div');
        section1.className = 'section';
        section1.innerHTML = `
            <h2>æ­¥éª¤1: éªŒè¯è¾“å…¥</h2>
            <p>ç®¡é“ç¬¦æ•°é‡: <strong>${(compressedTable.match(/\|/g) || []).length}</strong></p>
            <p>æ–‡æœ¬é•¿åº¦: <strong>${compressedTable.length}</strong></p>
            <p>åŒ…å«åˆ†éš”ç¬¦: <strong>${/\|(:?-+:?\|)+/.test(compressedTable) ? 'âœ“ æ˜¯' : 'âœ— å¦'}</strong></p>
        `;
        output.appendChild(section1);

        // æ­¥éª¤2: æµ‹è¯• MarkdownProcessorAST
        const section2 = document.createElement('div');
        section2.className = 'section';
        section2.innerHTML = `<h2>æ­¥éª¤2: MarkdownProcessorAST æ¸²æŸ“</h2>`;

        if (typeof MarkdownProcessorAST !== 'undefined') {
            try {
                logs.length = 0; // æ¸…ç©ºæ—¥å¿—
                const html = MarkdownProcessorAST.render(compressedTable);
                const hasTable = html.includes('<table');

                section2.innerHTML += `
                    <p class="${hasTable ? 'success' : 'fail'}">
                        ${hasTable ? 'âœ“ æˆåŠŸç”Ÿæˆè¡¨æ ¼' : 'âœ— æœªç”Ÿæˆè¡¨æ ¼'}
                    </p>
                    <div class="result">${html}</div>
                `;
            } catch (error) {
                section2.innerHTML += `
                    <p class="fail">âœ— æ¸²æŸ“å‡ºé”™: ${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
            }
        } else {
            section2.innerHTML += `<p class="fail">âœ— MarkdownProcessorAST æœªåŠ è½½</p>`;
        }
        output.appendChild(section2);

        // æ­¥éª¤3: æ˜¾ç¤ºæ—¥å¿—
        setTimeout(() => {
            const section3 = document.createElement('div');
            section3.className = 'section';
            section3.innerHTML = `
                <h2>æ­¥éª¤3: æ§åˆ¶å°æ—¥å¿— (${logs.length} æ¡)</h2>
                <div class="log">${logs.length > 0 ? logs.join('\n') : '(æ— æ—¥å¿—)'}</div>
            `;
            output.appendChild(section3);

            // æ­¥éª¤4: è·å–æŒ‡æ ‡
            if (typeof MarkdownProcessorAST !== 'undefined' && MarkdownProcessorAST.getMetrics) {
                const metrics = MarkdownProcessorAST.getMetrics();
                const section4 = document.createElement('div');
                section4.className = 'section';
                section4.innerHTML = `
                    <h2>æ­¥éª¤4: æ€§èƒ½æŒ‡æ ‡</h2>
                    <div class="log">${JSON.stringify(metrics, null, 2)}</div>
                `;
                output.appendChild(section4);
            }
        }, 200);
    </script>
</body>
</html>
