<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>KaTeX é”™è¯¯è¯Šæ–­</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-case {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .success { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .result {
            border: 3px solid #3498db;
            padding: 20px;
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 50px;
        }
        .error {
            background: #ffe3e3;
            border: 2px solid #e74c3c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #c92a2a;
        }
        .source {
            background: #f1f3f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        h2 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ” KaTeX é”™è¯¯è¯Šæ–­</h1>

    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                name: 'é—®é¢˜ 1: \\tag åœ¨è¡Œå†…å…¬å¼ä¸­',
                original: `i = \\left| {{0.37}{v}_{\\mathrm{r}}}\\right| + \\left| {{0.28}{d}_{\\mathrm{r}}}\\right| + \\left| {{0.2}{o}_{\\mathrm{r}}}\\right| + \\left| {{0.15}{t}_{\\mathrm{r}}}\\right| \\tag{7}`,
                displayMode: false,
                error: 'KaTeX parse error: \\tag works only in display equations'
            },
            {
                name: 'ä¿®å¤ 1: ä½¿ç”¨å—çº§å…¬å¼ï¼ˆdisplayMode: trueï¼‰',
                original: `i = \\left| {{0.37}{v}_{\\mathrm{r}}}\\right| + \\left| {{0.28}{d}_{\\mathrm{r}}}\\right| + \\left| {{0.2}{o}_{\\mathrm{r}}}\\right| + \\left| {{0.15}{t}_{\\mathrm{r}}}\\right| \\tag{7}`,
                displayMode: true,
                isFix: true
            },
            {
                name: 'é—®é¢˜ 2: \\;^\\circ è¯­æ³•é”™è¯¯',
                original: `0.1 - 0.2 \\mathrm{\\;^\\circ C}`,
                displayMode: false,
                error: 'KaTeX parse error: Got group of unknown type: \'internal\''
            },
            {
                name: 'ä¿®å¤ 2a: ä½¿ç”¨ ^{\\circ}',
                original: `0.1 - 0.2 \\mathrm{\\;^{\\circ} C}`,
                displayMode: false,
                isFix: true
            },
            {
                name: 'ä¿®å¤ 2b: ä½¿ç”¨ \\degree',
                original: `0.1 - 0.2 \\,\\mathrm{^\\circ C}`,
                displayMode: false,
                isFix: true
            },
            {
                name: 'ä¿®å¤ 2c: è°ƒæ•´ç©ºæ ¼å’Œæ‹¬å·',
                original: `0.1 - 0.2\\,^{\\circ}\\mathrm{C}`,
                displayMode: false,
                isFix: true
            },
            {
                name: 'é—®é¢˜åˆ†æ: åŒèŠ±æ‹¬å· {{...}}',
                original: `\\left| {{0.37}{v}_{\\mathrm{r}}}\\right|`,
                displayMode: false,
                note: 'åŒèŠ±æ‹¬å· {{...}} ä¼šè¢«è§£æä¸ºå†…éƒ¨ç»„'
            },
            {
                name: 'ä¿®å¤ 3: ç§»é™¤å¤šä½™èŠ±æ‹¬å·',
                original: `\\left| {0.37}{v}_{\\mathrm{r}}\\right|`,
                displayMode: false,
                isFix: true
            }
        ];

        testCases.forEach(test => {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';

            testDiv.innerHTML = `
                <h2>${test.name}</h2>
                <p><strong>å…¬å¼æºç :</strong></p>
                <div class="source">${test.original}</div>
            `;

            if (test.error) {
                testDiv.innerHTML += `
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong></p>
                    <div class="error">${test.error}</div>
                `;
            }

            if (test.note) {
                testDiv.innerHTML += `<p><em>${test.note}</em></p>`;
            }

            // å°è¯•æ¸²æŸ“
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result';

            try {
                const html = katex.renderToString(test.original, {
                    displayMode: test.displayMode || false,
                    throwOnError: false,
                    errorColor: '#e74c3c'
                });

                resultDiv.innerHTML = html;

                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                const hasError = html.includes('katex-error') || html.includes('parseerror');

                if (test.isFix) {
                    testDiv.innerHTML += hasError
                        ? `<p class="fail">âœ— ä¿®å¤å¤±è´¥</p>`
                        : `<p class="success">âœ“ ä¿®å¤æˆåŠŸ</p>`;
                }

                testDiv.innerHTML += `<p><strong>æ¸²æŸ“ç»“æœ:</strong></p>`;
                testDiv.appendChild(resultDiv);

            } catch (error) {
                testDiv.innerHTML += `
                    <p class="fail">âœ— æ¸²æŸ“å¼‚å¸¸</p>
                    <div class="error">${error.message}</div>
                `;
            }

            output.appendChild(testDiv);
        });

        // æ·»åŠ å»ºè®®
        setTimeout(() => {
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'test-case';
            suggestionDiv.innerHTML = `
                <h2>ğŸ’¡ ä¿®å¤å»ºè®®</h2>

                <h3>é—®é¢˜ 1: \\tag åªèƒ½åœ¨å—çº§å…¬å¼ä¸­ä½¿ç”¨</h3>
                <p><strong>åŸå› :</strong> KaTeX çš„ <code>\\tag</code> å‘½ä»¤åªèƒ½ç”¨äº display modeï¼ˆå—çº§å…¬å¼ï¼Œå³ <code>$$...$$</code>ï¼‰</p>
                <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                <ul>
                    <li><strong>æ–¹æ¡ˆ A:</strong> ä½¿ç”¨å—çº§å…¬å¼ <code>$$...\\tag{7}$$</code></li>
                    <li><strong>æ–¹æ¡ˆ B:</strong> ç§»é™¤ <code>\\tag</code>ï¼Œæ”¹ç”¨æ–‡æœ¬æ ‡æ³¨</li>
                    <li><strong>æ–¹æ¡ˆ C:</strong> åœ¨ formula_post_processor.js ä¸­è‡ªåŠ¨ç§»é™¤è¡Œå†…å…¬å¼çš„ <code>\\tag</code></li>
                </ul>

                <h3>é—®é¢˜ 2: \\;^\\circ è¯­æ³•é”™è¯¯</h3>
                <p><strong>åŸå› :</strong> <code>\\;</code> åé¢ç›´æ¥è·Ÿ <code>^</code> ä¼šäº§ç”Ÿå†…éƒ¨ç»„é”™è¯¯</p>
                <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                <ul>
                    <li><strong>æ¨è:</strong> <code>\\,^{\\circ}\\mathrm{C}</code> æˆ– <code>^{\\circ}\\mathrm{C}</code></li>
                    <li><strong>æˆ–:</strong> <code>\\mathrm{\\,^{\\circ}C}</code>ï¼ˆèŠ±æ‹¬å·åŒ…å›´ä¸Šæ ‡ï¼‰</li>
                </ul>

                <h3>é—®é¢˜ 3: åŒèŠ±æ‹¬å· {{...}}</h3>
                <p><strong>åŸå› :</strong> åŒèŠ±æ‹¬å·åœ¨ LaTeX ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå¯èƒ½å¯¼è‡´è§£æé”™è¯¯</p>
                <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                <ul>
                    <li>åªä½¿ç”¨å•å±‚èŠ±æ‹¬å· <code>{0.37}</code></li>
                    <li>æˆ–è€…å®Œå…¨ç§»é™¤ä¸å¿…è¦çš„èŠ±æ‹¬å·</li>
                </ul>

                <h3>ğŸ”§ è‡ªåŠ¨ä¿®å¤å»ºè®®</h3>
                <p>åœ¨ <code>formula_post_processor.js</code> ä¸­æ·»åŠ ä»¥ä¸‹ä¿®å¤è§„åˆ™ï¼š</p>
                <ol>
                    <li>æ£€æµ‹è¡Œå†…å…¬å¼ä¸­çš„ <code>\\tag{...}</code> å¹¶ç§»é™¤æˆ–è½¬æ¢ä¸ºå—çº§</li>
                    <li>ä¿®å¤ <code>\\;^\\circ</code> â†’ <code>\\,^{\\circ}</code></li>
                    <li>ç§»é™¤å¤šä½™çš„åŒèŠ±æ‹¬å· <code>{{...}}</code> â†’ <code>{...}</code></li>
                </ol>
            `;
            output.appendChild(suggestionDiv);
        }, 100);
    </script>
</body>
</html>
