<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¡¨æ ¼åˆ—æ•°ä¸åŒ¹é…ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="../js/processing/markdown_processor_ast.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1600px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        h1 {
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .test-case {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .success { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .result {
            border: 3px solid #3498db;
            padding: 20px;
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .result table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background: white;
        }
        .result th, .result td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }
        .result th {
            background: linear-gradient(135deg, #4c6ef5, #364fc7);
            color: white;
            font-weight: bold;
        }
        .result tr:nth-child(even) {
            background: #f8f9fa;
        }
        .source {
            background: #fff3bf;
            border: 2px dashed #fcc419;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            white-space: pre-wrap;
        }
        h2 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ è¡¨æ ¼åˆ—æ•°ä¸åŒ¹é…ä¿®å¤æµ‹è¯•</h1>

    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        const logs = [];

        // æ‹¦æˆªconsole.log
        const originalLog = console.log;
        console.log = function(...args) {
            logs.push(args.join(' '));
            originalLog.apply(console, args);
        };

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                name: 'Block #31 (è¡¨å¤´6åˆ—ï¼Œåˆ†éš”ç¬¦7åˆ—)',
                markdown: `| | | | äº”åˆ†ä½æ•° (Quintiles) | | |
|---|---|---|---|---|---|---|
| | 1 | 2 | 3 | 4 | 5 | 5-1 |
| å¸‚åœº (Market) | 0.145*** | 0.200** | 0.061* | 0.136* | 0.106*** | -0.039 |`
            },
            {
                name: 'ç®€å•æµ‹è¯• (è¡¨å¤´3åˆ—ï¼Œåˆ†éš”ç¬¦4åˆ—)',
                markdown: `| A | B | C |
|---|---|---|---|
| 1 | 2 | 3 |
| 4 | 5 | 6 |`
            },
            {
                name: 'è¡¨å¤´å¤šåˆ— (è¡¨å¤´5åˆ—ï¼Œåˆ†éš”ç¬¦3åˆ—)',
                markdown: `| A | B | C | D | E |
|---|---|---|
| 1 | 2 | 3 | 4 | 5 |`
            }
        ];

        testCases.forEach((test, idx) => {
            logs.length = 0; // æ¸…ç©ºæ—¥å¿—

            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';

            testDiv.innerHTML = `<h2>${test.name}</h2>`;

            // æ˜¾ç¤ºåŸå§‹ Markdown
            testDiv.innerHTML += `
                <h3>åŸå§‹ Markdown:</h3>
                <div class="source">${test.markdown}</div>
            `;

            // åˆ†æåˆ—æ•°
            const lines = test.markdown.split('\n');
            const headerPipes = (lines[0].match(/\|/g) || []).length;
            const separatorPipes = (lines[1].match(/\|/g) || []).length;

            testDiv.innerHTML += `
                <p>è¡¨å¤´ç®¡é“ç¬¦: <strong>${headerPipes}</strong> (${headerPipes - 1} åˆ—)</p>
                <p>åˆ†éš”ç¬¦ç®¡é“ç¬¦: <strong>${separatorPipes}</strong> (${separatorPipes - 1} åˆ—)</p>
                ${headerPipes !== separatorPipes ? '<p class="fail">âš ï¸ åˆ—æ•°ä¸åŒ¹é…ï¼</p>' : '<p class="success">âœ“ åˆ—æ•°åŒ¹é…</p>'}
            `;

            // ä½¿ç”¨ MarkdownProcessorAST æ¸²æŸ“
            if (typeof MarkdownProcessorAST !== 'undefined' && MarkdownProcessorAST.render) {
                const rendered = MarkdownProcessorAST.render(test.markdown, {});
                const isTable = rendered.trim().startsWith('<table');

                testDiv.innerHTML += `
                    <h3>æ¸²æŸ“ç»“æœ:</h3>
                    <p>${isTable ? '<span class="success">âœ“ æˆåŠŸæ¸²æŸ“ä¸º &lt;table&gt;</span>' : '<span class="fail">âœ— æ¸²æŸ“ä¸º &lt;p&gt;</span>'}</p>
                    <div class="result">${rendered}</div>
                `;

                if (logs.length > 0) {
                    testDiv.innerHTML += `
                        <h3>ä¿®å¤æ—¥å¿—:</h3>
                        <div class="log">${logs.join('\n')}</div>
                    `;
                }
            } else {
                testDiv.innerHTML += '<p class="fail">âœ— MarkdownProcessorAST æœªåŠ è½½</p>';
            }

            output.appendChild(testDiv);
        });

        // æ·»åŠ è¯´æ˜
        setTimeout(() => {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-case';
            infoDiv.innerHTML = `
                <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
                <p><strong>ä¿®å¤ç­–ç•¥ï¼š</strong></p>
                <ul>
                    <li><strong>è¡¨å¤´åˆ—æ•° < åˆ†éš”ç¬¦åˆ—æ•°ï¼š</strong>åˆ é™¤åˆ†éš”ç¬¦çš„å¤šä½™åˆ—</li>
                    <li><strong>è¡¨å¤´åˆ—æ•° > åˆ†éš”ç¬¦åˆ—æ•°ï¼š</strong>ç»™åˆ†éš”ç¬¦æ·»åŠ  <code>---|</code></li>
                    <li><strong>æ•°æ®è¡Œåˆ—æ•° < åˆ†éš”ç¬¦åˆ—æ•°ï¼š</strong>ç»™æ•°æ®è¡Œæ·»åŠ ç©ºå•å…ƒæ ¼ <code> |</code></li>
                </ul>

                <h2>âœ… éªŒè¯æ­¥éª¤</h2>
                <ol>
                    <li>æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹åº”æ˜¾ç¤ºä¸º <code>&lt;table&gt;</code> è€Œé <code>&lt;p&gt;</code></li>
                    <li>ä¿®å¤æ—¥å¿—åº”æ˜¾ç¤ºåˆ—æ•°è°ƒæ•´ä¿¡æ¯</li>
                    <li>è¡¨æ ¼åº”æ­£ç¡®æ˜¾ç¤ºè¾¹æ¡†å’Œæ ·å¼</li>
                </ol>

                <h2>ğŸš€ ä¸‹ä¸€æ­¥</h2>
                <p>å¦‚æœæ­¤æµ‹è¯•é€šè¿‡ï¼Œè¯·åˆ·æ–°å®é™…åº”ç”¨ (Ctrl + Shift + R) æ¥éªŒè¯ Block #31 çš„æ¸²æŸ“ã€‚</p>
            `;
            output.appendChild(infoDiv);
        }, 100);
    </script>
</body>
</html>
