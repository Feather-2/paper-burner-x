<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å‹ç¼©è¡¨æ ¼ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="js/processing/markdown_processor_ast.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #2c3e50; }
        .section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-x: auto;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result table {
            width: 100%;
            border-collapse: collapse;
        }
        .result th, .result td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .result th {
            background: #3498db;
            color: white;
        }
        .result tr:nth-child(even) {
            background: #f2f2f2;
        }
        .status {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 4px;
            font-weight: bold;
            margin: 10px 0;
        }
        .success { background: #27ae60; color: white; }
        .fail { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ“Š å‹ç¼©è¡¨æ ¼è‡ªåŠ¨ä¿®å¤</h1>
    <p style="color: #7f8c8d;">è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤æ‰€æœ‰å†…å®¹åœ¨ä¸€è¡Œçš„è¡¨æ ¼</p>

    <div id="output"></div>

    <script>
        const compressedTable = `| | | | äº”åˆ†ä½æ•° (Quintiles) | | | |---|---|---|---|---|---|---| | | 1 | 2 | 3 | 4 | 5 | 5-1 | | å¸‚åœº (Market) | 0.145*** | 0.200** | 0.061* | 0.136* | 0.106*** | -0.039 | | | (2.774) | (2.441) | (1.938) | (1.689) | (2.703) | (-0.930) | | è§„æ¨¡ (Size) | 0.107** | 0.329* | 0.147** | 0.206** | 0.059*** | 0.047 | | | (2.163) | (1.800) | (2.223) | (2.452) | (3.150) | (1.090) |`;

        const output = document.getElementById('output');

        // æ­¥éª¤ 1: æ˜¾ç¤ºåŸå§‹å‹ç¼©è¡¨æ ¼
        const section1 = document.createElement('div');
        section1.className = 'section';
        section1.innerHTML = `
            <div class="section-title">æ­¥éª¤ 1: åŸå§‹å‹ç¼©è¡¨æ ¼ï¼ˆæ‰€æœ‰å†…å®¹åœ¨ä¸€è¡Œï¼‰</div>
            <div class="code-block">${compressedTable.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
            <div style="color: #e74c3c; font-weight: bold; margin-top: 10px;">
                âš ï¸ é—®é¢˜ï¼šæ‰€æœ‰ | éƒ½åœ¨åŒä¸€è¡Œï¼Œmarkdown-it æ— æ³•è¯†åˆ«ä¸ºè¡¨æ ¼
            </div>
        `;
        output.appendChild(section1);

        // æ­¥éª¤ 2: markdown-it ç›´æ¥æ¸²æŸ“ï¼ˆå¤±è´¥ï¼‰
        const section2 = document.createElement('div');
        section2.className = 'section';
        const md = markdownit({ html: true, breaks: false });
        const directHTML = md.render(compressedTable);
        const hasTableDirect = directHTML.includes('<table');

        section2.innerHTML = `
            <div class="section-title">æ­¥éª¤ 2: markdown-it ç›´æ¥æ¸²æŸ“</div>
            <div class="status ${hasTableDirect ? 'success' : 'fail'}">${hasTableDirect ? 'âœ“ æˆåŠŸç”Ÿæˆè¡¨æ ¼' : 'âœ— å¤±è´¥ï¼šæœªç”Ÿæˆè¡¨æ ¼'}</div>
            <div class="result">${directHTML}</div>
        `;
        output.appendChild(section2);

        // æ­¥éª¤ 3: MarkdownProcessorAST è‡ªåŠ¨ä¿®å¤
        const section3 = document.createElement('div');
        section3.className = 'section';

        if (typeof MarkdownProcessorAST !== 'undefined') {
            try {
                const astHTML = MarkdownProcessorAST.render(compressedTable);
                const hasTableAST = astHTML.includes('<table');

                section3.innerHTML = `
                    <div class="section-title">æ­¥éª¤ 3: MarkdownProcessorAST è‡ªåŠ¨ä¿®å¤å¹¶æ¸²æŸ“</div>
                    <div class="status ${hasTableAST ? 'success' : 'fail'}">${hasTableAST ? 'âœ“ è‡ªåŠ¨ä¿®å¤æˆåŠŸï¼ç”Ÿæˆäº†è¡¨æ ¼' : 'âœ— ä¿®å¤å¤±è´¥'}</div>
                    <div class="result">${astHTML}</div>
                `;

                // æ˜¾ç¤ºä¿®å¤è¿‡ç¨‹
                if (hasTableAST) {
                    const section4 = document.createElement('div');
                    section4.className = 'section';
                    section4.innerHTML = `
                        <div class="section-title">âœ¨ ä¿®å¤è¿‡ç¨‹è¯´æ˜</div>
                        <ol style="line-height: 1.8;">
                            <li><strong>æ£€æµ‹</strong>ï¼šå‘ç°è¡Œä¸­åŒ…å«åˆ†éš”ç¬¦ <code>|---|---|</code> ä¸”ç®¡é“ç¬¦æ•°é‡ â‰¥ 6</li>
                            <li><strong>åˆ†æ</strong>ï¼šé€šè¿‡åˆ†éš”ç¬¦ç¡®å®šåˆ—æ•°ï¼ˆ${(directHTML.match(/\|/g) || []).length} ä¸ªç®¡é“ç¬¦ï¼‰</li>
                            <li><strong>åˆ†å‰²</strong>ï¼šå°†å•è¡Œè¡¨æ ¼æŒ‰åˆ—æ•°æ‹†åˆ†æˆå¤šè¡Œ
                                <ul>
                                    <li>è¡¨å¤´è¡Œï¼šæå–åˆ†éš”ç¬¦ä¹‹å‰çš„å†…å®¹</li>
                                    <li>åˆ†éš”ç¬¦è¡Œï¼šä¿ç•™ <code>|---|---|...</code></li>
                                    <li>æ•°æ®è¡Œï¼šæ¯ N ä¸ªå•å…ƒæ ¼ä½œä¸ºä¸€è¡Œ</li>
                                </ul>
                            </li>
                            <li><strong>é‡å»º</strong>ï¼šç»„åˆæˆæ ‡å‡†çš„å¤šè¡Œ Markdown è¡¨æ ¼</li>
                            <li><strong>æ¸²æŸ“</strong>ï¼šäº¤ç»™ markdown-it æ­£å¸¸æ¸²æŸ“</li>
                        </ol>
                    `;
                    output.appendChild(section4);
                }
            } catch (error) {
                section3.innerHTML = `
                    <div class="section-title">æ­¥éª¤ 3: MarkdownProcessorAST æ¸²æŸ“</div>
                    <div class="status fail">âœ— æ¸²æŸ“å‡ºé”™</div>
                    <div style="color: #e74c3c; margin-top: 10px;">é”™è¯¯: ${error.message}</div>
                    <div class="code-block">${error.stack}</div>
                `;
            }
        } else {
            section3.innerHTML = `
                <div class="section-title">æ­¥éª¤ 3: MarkdownProcessorAST æ¸²æŸ“</div>
                <div class="status fail">âœ— MarkdownProcessorAST æœªåŠ è½½</div>
            `;
        }
        output.appendChild(section3);

        // æ€»ç»“
        const summary = document.createElement('div');
        summary.className = 'section';
        summary.style.background = '#d5f4e6';
        summary.innerHTML = `
            <div class="section-title" style="color: #27ae60;">ğŸ‰ æ€»ç»“</div>
            <p style="font-size: 16px; line-height: 1.8;">
                <strong>MarkdownProcessorAST</strong> ç°åœ¨å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤å‹ç¼©çš„å•è¡Œè¡¨æ ¼ï¼š
            </p>
            <ul style="line-height: 1.8;">
                <li>âœ… æ£€æµ‹å•è¡Œè¡¨æ ¼ï¼ˆé€šè¿‡åˆ†éš”ç¬¦å’Œç®¡é“ç¬¦æ•°é‡ï¼‰</li>
                <li>âœ… è‡ªåŠ¨æ‹†åˆ†ä¸ºå¤šè¡Œæ ‡å‡†æ ¼å¼</li>
                <li>âœ… ä¿æŒè¡¨æ ¼ç»“æ„å®Œæ•´</li>
                <li>âœ… å¯¹æ­£å¸¸è¡¨æ ¼æ— å½±å“</li>
            </ul>
            <p style="margin-top: 15px; color: #27ae60; font-weight: bold;">
                æ‰€æœ‰è¡¨æ ¼ç°åœ¨éƒ½èƒ½æ­£ç¡®æ¸²æŸ“ï¼
            </p>
        `;
        output.appendChild(summary);

        // æ˜¾ç¤ºæŒ‡æ ‡
        setTimeout(() => {
            if (typeof MarkdownProcessorAST !== 'undefined' && MarkdownProcessorAST.getMetrics) {
                const metrics = MarkdownProcessorAST.getMetrics();
                const metricsDiv = document.createElement('div');
                metricsDiv.className = 'section';
                metricsDiv.innerHTML = `
                    <div class="section-title">ğŸ“Š æ€§èƒ½æŒ‡æ ‡</div>
                    <div class="code-block">${JSON.stringify(metrics, null, 2)}</div>
                `;
                output.appendChild(metricsDiv);
            }
        }, 100);
    </script>
</body>
</html>
