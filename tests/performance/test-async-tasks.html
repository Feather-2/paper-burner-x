<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éªŒè¯ï¼šé¡µé¢éšè—ä¸å½±å“å¼‚æ­¥ä»»åŠ¡</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 40px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        button {
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }
        .log-entry.info { color: #4FC3F7; }
        .log-entry.success { color: #4CAF50; font-weight: bold; }
        .log-entry.error { color: #EF5350; }
        .log-entry.warning { color: #FFA726; }
        .result {
            font-size: 18px;
            font-weight: bold;
            padding: 20px;
            text-align: center;
            border-radius: 4px;
            margin: 20px 0;
        }
        .result.pass {
            background: #d4edda;
            color: #155724;
        }
        .result.fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª éªŒè¯ï¼šé¡µé¢éšè—ä¸å½±å“å¼‚æ­¥ä»»åŠ¡</h1>

        <div class="warning">
            <strong>âš ï¸ é‡è¦è¯´æ˜</strong><br>
            æœ¬æµ‹è¯•è¯æ˜ï¼šå³ä½¿é¡µé¢éšè—ï¼Œ<strong>fetch()ã€Promiseã€async/await</strong> ç­‰å¼‚æ­¥ä»»åŠ¡<strong>ä»ç„¶æ­£å¸¸æ‰§è¡Œ</strong>ã€‚
            <br>æˆ‘ä»¬çš„ä¼˜åŒ–åªå½±å“äº† <code>setInterval</code> è½®è¯¢ï¼Œä¸å½±å“æ ¸å¿ƒä¸šåŠ¡ã€‚
        </div>

        <div class="info">
            <strong>ğŸ“‹ æµ‹è¯•æ­¥éª¤</strong><br>
            1. ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æ¨¡æ‹Ÿç¿»è¯‘ä»»åŠ¡<br>
            2. <strong>ç«‹å³åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µ</strong>ï¼ˆè¿™ä¼šè§¦å‘é¡µé¢éšè—ï¼‰<br>
            3. ç­‰å¾… 3-5 ç§’ååˆ‡å›æ¥<br>
            4. æŸ¥çœ‹ç»“æœï¼šä»»åŠ¡åº”è¯¥å·²ç»å®Œæˆ âœ…
        </div>

        <h2>æµ‹è¯• 1: æ¨¡æ‹Ÿç¿»è¯‘ API è°ƒç”¨</h2>
        <button onclick="testTranslationAPI()">ğŸ”„ å¼€å§‹æ¨¡æ‹Ÿç¿»è¯‘ï¼ˆ3ç§’ï¼‰</button>
        <button onclick="testMultipleAPIs()">ğŸ”„ æ¨¡æ‹Ÿå¤šä¸ªå¹¶å‘ç¿»è¯‘ï¼ˆ5ç§’ï¼‰</button>

        <h2>æµ‹è¯• 2: æ¨¡æ‹Ÿ AI å¯¹è¯</h2>
        <button onclick="testAIChatAPI()">ğŸ’¬ å¼€å§‹æ¨¡æ‹ŸAIå¯¹è¯ï¼ˆ3ç§’ï¼‰</button>

        <h2>æµ‹è¯• 3: å¯¹æ¯” setIntervalï¼ˆæˆ‘ä»¬ä¼˜åŒ–çš„éƒ¨åˆ†ï¼‰</h2>
        <button onclick="testSetInterval()">â±ï¸ å¯åŠ¨å®šæ—¶å™¨ï¼ˆè§‚å¯Ÿé¡µé¢éšè—æ—¶çš„è¡Œä¸ºï¼‰</button>
        <button onclick="stopSetInterval()">â¹ï¸ åœæ­¢å®šæ—¶å™¨</button>

        <div id="result"></div>

        <div class="log" id="log"></div>
    </div>

    <script>
        const logEl = document.getElementById('log');
        const resultEl = document.getElementById('result');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            logEl.innerHTML = '';
            resultEl.innerHTML = '';
        }

        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                log('ğŸ”’ é¡µé¢å·²éšè—ï¼ˆåˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼‰', 'warning');
            } else {
                log('ğŸ‘ï¸ é¡µé¢å¯è§ï¼ˆåˆ‡å›å½“å‰æ ‡ç­¾é¡µï¼‰', 'info');
            }
        });

        // ================================================
        // æµ‹è¯• 1: æ¨¡æ‹Ÿç¿»è¯‘ API
        // ================================================
        async function testTranslationAPI() {
            clearLog();
            log('=== å¼€å§‹æµ‹è¯•ï¼šæ¨¡æ‹Ÿç¿»è¯‘ API ===', 'info');
            log('âš ï¸ è¯·åœ¨ 3 ç§’å†…åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼', 'warning');

            const startTime = Date.now();

            // æ¨¡æ‹Ÿç¿»è¯‘ API è°ƒç”¨ï¼ˆ3ç§’å»¶è¿Ÿï¼‰
            try {
                log('ğŸ“¤ å‘é€ç¿»è¯‘è¯·æ±‚...', 'info');

                // ä½¿ç”¨çœŸå®çš„ Promiseï¼ˆæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼‰
                const result = await new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            success: true,
                            translatedText: 'è¿™æ˜¯ç¿»è¯‘åçš„æ–‡æœ¬',
                            pageHiddenDuringTranslation: false
                        });
                    }, 3000);
                });

                const endTime = Date.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(1);

                log('âœ… ç¿»è¯‘å®Œæˆï¼', 'success');
                log(`â±ï¸ è€—æ—¶: ${elapsed} ç§’`, 'info');
                log(`ğŸ“¥ ç»“æœ: ${result.translatedText}`, 'success');

                // æ˜¾ç¤ºç»“æœ
                resultEl.innerHTML = `
                    <div class="result pass">
                        âœ… æµ‹è¯•é€šè¿‡ï¼<br>
                        å³ä½¿é¡µé¢è¢«éšè—ï¼Œç¿»è¯‘ä»»åŠ¡ä»ç„¶å®Œæˆäº†ï¼<br>
                        <small>è€—æ—¶: ${elapsed} ç§’</small>
                    </div>
                `;

                log('ğŸ’¡ ç»“è®ºï¼šfetch() / Promise ä¸å—é¡µé¢éšè—å½±å“', 'success');

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`, 'error');
                resultEl.innerHTML = `
                    <div class="result fail">
                        âŒ æµ‹è¯•å¤±è´¥ï¼<br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // ================================================
        // æµ‹è¯• 2: æ¨¡æ‹Ÿå¤šä¸ªå¹¶å‘ç¿»è¯‘
        // ================================================
        async function testMultipleAPIs() {
            clearLog();
            log('=== å¼€å§‹æµ‹è¯•ï¼šå¤šä¸ªå¹¶å‘ç¿»è¯‘ ===', 'info');
            log('âš ï¸ è¯·åœ¨ 5 ç§’å†…åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼', 'warning');

            const startTime = Date.now();

            // æ¨¡æ‹Ÿ 3 ä¸ªå¹¶å‘ç¿»è¯‘ä»»åŠ¡
            const tasks = [
                simulateTranslation('æ®µè½ 1', 2000),
                simulateTranslation('æ®µè½ 2', 3000),
                simulateTranslation('æ®µè½ 3', 4000)
            ];

            try {
                log('ğŸ“¤ å‘é€ 3 ä¸ªå¹¶å‘ç¿»è¯‘è¯·æ±‚...', 'info');

                const results = await Promise.all(tasks);

                const endTime = Date.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(1);

                log('âœ… æ‰€æœ‰ç¿»è¯‘å®Œæˆï¼', 'success');
                log(`â±ï¸ æ€»è€—æ—¶: ${elapsed} ç§’`, 'info');
                results.forEach((result, i) => {
                    log(`ğŸ“¥ ç»“æœ ${i + 1}: ${result}`, 'success');
                });

                resultEl.innerHTML = `
                    <div class="result pass">
                        âœ… æµ‹è¯•é€šè¿‡ï¼<br>
                        ${results.length} ä¸ªå¹¶å‘ç¿»è¯‘ä»»åŠ¡éƒ½å®Œæˆäº†ï¼<br>
                        <small>æ€»è€—æ—¶: ${elapsed} ç§’</small>
                    </div>
                `;

                log('ğŸ’¡ ç»“è®ºï¼šå¤šä¸ªå¼‚æ­¥ä»»åŠ¡å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä¸å—é¡µé¢éšè—å½±å“', 'success');

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function simulateTranslation(text, delay) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(`${text} (å·²ç¿»è¯‘)`);
                }, delay);
            });
        }

        // ================================================
        // æµ‹è¯• 3: æ¨¡æ‹Ÿ AI å¯¹è¯
        // ================================================
        async function testAIChatAPI() {
            clearLog();
            log('=== å¼€å§‹æµ‹è¯•ï¼šæ¨¡æ‹Ÿ AI å¯¹è¯ ===', 'info');
            log('âš ï¸ è¯·åœ¨ 3 ç§’å†…åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼', 'warning');

            const startTime = Date.now();

            try {
                log('ğŸ’¬ å‘é€ AI å¯¹è¯è¯·æ±‚...', 'info');

                // æ¨¡æ‹Ÿ AI API è°ƒç”¨
                const result = await new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            message: 'è¿™æ˜¯ AI çš„å›å¤å†…å®¹',
                            tokens: 150
                        });
                    }, 3000);
                });

                const endTime = Date.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(1);

                log('âœ… AI å›å¤å®Œæˆï¼', 'success');
                log(`â±ï¸ è€—æ—¶: ${elapsed} ç§’`, 'info');
                log(`ğŸ’¬ å›å¤: ${result.message}`, 'success');

                resultEl.innerHTML = `
                    <div class="result pass">
                        âœ… æµ‹è¯•é€šè¿‡ï¼<br>
                        AI å¯¹è¯åœ¨é¡µé¢éšè—æ—¶ä»ç„¶æ­£å¸¸å®Œæˆï¼<br>
                        <small>è€—æ—¶: ${elapsed} ç§’</small>
                    </div>
                `;

                log('ğŸ’¡ ç»“è®ºï¼šAI å¯¹è¯ API ä¸å—é¡µé¢éšè—å½±å“', 'success');

            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // ================================================
        // æµ‹è¯• 4: setIntervalï¼ˆå¯¹æ¯”ï¼‰
        // ================================================
        let intervalId = null;
        let intervalCount = 0;

        function testSetInterval() {
            if (intervalId) {
                log('âš ï¸ å®šæ—¶å™¨å·²åœ¨è¿è¡Œ', 'warning');
                return;
            }

            clearLog();
            log('=== å¼€å§‹æµ‹è¯•ï¼šsetInterval è¡Œä¸ºï¼ˆå¯¹æ¯”ï¼‰ ===', 'info');
            log('ğŸ”„ å®šæ—¶å™¨å¯åŠ¨ï¼ˆæ¯ç§’æ‰§è¡Œä¸€æ¬¡ï¼‰', 'info');
            log('âš ï¸ è¯·åˆ‡æ¢æ ‡ç­¾é¡µè§‚å¯Ÿè¡Œä¸º', 'warning');

            intervalCount = 0;

            intervalId = setInterval(() => {
                intervalCount++;

                // æ£€æŸ¥é¡µé¢æ˜¯å¦éšè—
                if (document.hidden) {
                    log(`â­ï¸ è·³è¿‡æ‰§è¡Œï¼ˆé¡µé¢éšè—ï¼Œè®¡æ•°: ${intervalCount}ï¼‰`, 'warning');
                    // è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ annotations_summary_modal.js ä¸­åšçš„ä¼˜åŒ–
                } else {
                    log(`âœ“ æ­£å¸¸æ‰§è¡Œï¼ˆé¡µé¢å¯è§ï¼Œè®¡æ•°: ${intervalCount}ï¼‰`, 'success');
                }
            }, 1000);

            log('ğŸ’¡ è¯´æ˜ï¼šè¿™å°±æ˜¯æˆ‘ä»¬çš„ä¼˜åŒ–é€»è¾‘ - é¡µé¢éšè—æ—¶è·³è¿‡æ‰§è¡Œ', 'info');
            log('ğŸ’¡ ä½† fetch() ç­‰å¼‚æ­¥ä»»åŠ¡ä¸ä¼šè¢«è·³è¿‡ï¼', 'success');
        }

        function stopSetInterval() {
            if (!intervalId) {
                log('âš ï¸ å®šæ—¶å™¨æœªè¿è¡Œ', 'warning');
                return;
            }

            clearInterval(intervalId);
            intervalId = null;

            log(`â¹ï¸ å®šæ—¶å™¨å·²åœæ­¢ï¼ˆæ€»è®¡æ‰§è¡Œ ${intervalCount} æ¬¡ï¼‰`, 'info');
        }

        // ================================================
        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        // ================================================
        window.addEventListener('load', () => {
            log('ğŸš€ æµ‹è¯•å·¥å…·å·²åŠ è½½', 'info');
            log('ğŸ’¡ æç¤ºï¼šæµ‹è¯•è¿‡ç¨‹ä¸­è¯·åˆ‡æ¢æ ‡ç­¾é¡µæ¥éªŒè¯å¼‚æ­¥ä»»åŠ¡ä¸å—å½±å“', 'info');
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', () => {
            if (intervalId) {
                clearInterval(intervalId);
            }
        });
    </script>
</body>
</html>
